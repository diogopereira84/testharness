<?php
/**
 * Copyright Â© Fedex All rights reserved.
 * See COPYING.txt for license details.
 */

namespace Fedex\Orderhistory\Test\Unit\ViewModel;

use Magento\Framework\TestFramework\Unit\Helper\ObjectManager;
use Fedex\Orderhistory\Helper\Data;
use Fedex\Orderhistory\ViewModel\OrderHistoryReorder;

class OrderHistoryReorderTest extends \PHPUnit\Framework\TestCase
{
   protected $orderHistoryhelperMock;
    /**
     * @var \Magento\Framework\TestFramework\Unit\Helper\ObjectManager
     */
    protected $objectManager;
    protected $orderHistoryReorderMock;
    /**
    * setup method
    */
    protected function setUp(): void
    {
        $this->orderHistoryhelperMock = $this->getMockBuilder(Data::class)
            ->setMethods(['isRetailOrderHistoryReorderEnabled'])
            ->disableOriginalConstructor()
            ->getMock();

        $this->objectManager = new ObjectManager($this);
        $this->orderHistoryReorderMock = $this->objectManager->getObject(
            OrderHistoryReorder::class,
            [
                'orderHistoryhelper' => $this->orderHistoryhelperMock
            ]
        );
    }

    /**
     * Assert isRetailOrderHistoryReorderEnabled
     *
     * @return boolean
     */
    public function testIsRetailOrderHistoryReorderEnabled()
    {
        $this->orderHistoryhelperMock->expects($this->any())->method('isRetailOrderHistoryReorderEnabled')
        ->willReturn(true);
        $this->assertEquals(true, $this->orderHistoryReorderMock->isRetailOrderHistoryReorderEnabled());
    }

    /**
     * test serializeProductData
     *
     * @return void
     */
    public function testSerializeProductData()
    {   
        $externalProductData = '{"external_prod":[{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169046574124984641609941565731181136468","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}],"preview_url":"13169046574124984641609941565731181136468","fxo_product":""}]}';

        $serializedProductData = '{"serializedProductData":{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169046574124984641609941565731181136468","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}]},"productPresetId":true}';

        $fxoP = '{"fxoMenuId":"1614105200640-4","fxoProductInstance":{"id":"1661222574939","name":"Flyers","productConfig":{"product":{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169008874182887338515073287980402046350","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}]},"productPresetId":"1602518818916","fileCreated":"2022-08-23T02:43:21.013Z"},"productRateTotal":{"unitPrice":null,"currency":"USD","quantity":50,"price":"$50.82","priceAfterDiscount":"$50.82","unitOfMeasure":"EACH","totalDiscount":"$0.00","productLineDetails":[{"detailCode":"40005","description":"Full Pg Clr Flyr 50","detailCategory":"PRINTING","unitQuantity":1,"detailPrice":"$50.82","detailDiscountPrice":"$0.00","detailUnitPrice":"$50.8200","detailDiscountedUnitPrice":"$0.00"}]},"isUpdateButtonVisible":false,"quantityChoices":["50","100","250","500","1000"],"isEditable":true,"isEdited":false,"fileManagementState":{"availableFileItems":[{"file":[],"fileItem":{"fileId":"13169008873132051940009207686081156257085","fileName":"aviso.jpg","fileExtension":"jpg","fileSize":145267,"createdTimestamp":"2022-08-23T02:43:28.366Z"},"uploadStatus":"Success","errorMsg":"","uploadProgressPercentage":100,"uploadProgressBytesLoaded":145455,"selected":false,"httpRsp":{"successful":true,"output":{"document":{"documentId":"13169008873132051940009207686081156257085","documentName":"aviso.jpg","documentSize":145265,"printReady":false}}}}],"projects":[{"fileItems":[{"uploadStatus":"Success","errorMsg":"","selected":false,"originalFileItem":{"fileId":"13169008873132051940009207686081156257085","fileName":"aviso.jpg","fileExtension":"jpg","fileSize":145267,"createdTimestamp":"2022-08-23T02:43:28.366Z"},"convertStatus":"Success","convertedFileItem":{"fileId":"13169008874182887338515073287980402046350","fileName":"aviso.jpg","fileExtension":"pdf","fileSize":147402,"createdTimestamp":"2022-08-23T02:43:29.754Z","numPages":1},"orientation":"LANDSCAPE","conversionResult":{"parentDocumentId":"13169008873132051940009207686081156257085","originalDocumentName":"aviso.jpg","printReadyFlag":true,"previewURI":"https:\/\/dunc6.dmz.fedex.com\/document\/fedexoffice\/v1\/documents\/13169008874182887338515073287980402046350\/preview","documentSize":147402,"documentType":"IMAGE","lowResImage":true,"documentId":"13169008874182887338515073287980402046350","metrics":{"pageCount":1,"pageGroups":[{"startPageNum":1,"endPageNum":1,"pageWidthInches":11,"pageHeightInches":8.5}]}},"contentAssociation":{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169008874182887338515073287980402046350","contentType":"IMAGE","fileSizeBytes":"147402","fileName":"aviso.jpg","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}],"contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":""}}],"projectName":"Flyers","productId":"1463680545590","productPresetId":"1602518818916","productVersion":null,"controlId":"4","maxFiles":2,"productType":"Flyers","availableSizes":"8.5\"x11\"","convertStatus":"Success","showInList":true,"firstInList":false,"accordionOpen":true,"needsToBeConverted":false,"selected":false,"mayContainUserSelections":false,"hasUserChangedProjectNameManually":false,"supportedProductSizes":{"featureId":"1448981549109","featureName":"Size","choices":[{"choiceId":"1448986650332","choiceName":"8.5\"x11\"","properties":[{"name":"MEDIA_HEIGHT","value":"11"},{"name":"MEDIA_WIDTH","value":"8.5"},{"name":"DISPLAY_HEIGHT","value":"11"},{"name":"DISPLAY_WIDTH","value":"8.5"}]}]},"productConfig":{"product":{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169008874182887338515073287980402046350","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}]},"productPresetId":"1602518818916","fileCreated":"2022-08-23T02:43:21.013Z"}}],"catalogManageFilesToggle":true,"displayErrorIds":false}},"productType":"PRINT_PRODUCT","instanceId":"5783865047230648"}';
        $externalProductData = json_decode($externalProductData, true);
        $serializedProductData = json_decode($serializedProductData, true);
        $externalProductData['external_prod'][0]['fxo_product'] = $fxoP;

        $this->assertEquals($serializedProductData, $this->orderHistoryReorderMock->serializeProductData($externalProductData));
    }

    /**
     * test serializeProductData with new json 
     *
     * @return void
     */
    public function testSerializeProductDataWithNewJson()
    {   
        $externalProductData = '{ "external_prod": [ { "productionContentAssociations": [], "userProductName": "Flyers", "id": "1463680545590", "version": 1, "name": "Flyer", "qty": 50, "priceable": true, "instanceId": 1661222574939, "proofRequired": false, "isOutSourced": false, "features": [ { "id": "1448981549109", "name": "Paper Size", "choice": { "id": "1448986650332", "name": "8.5x11", "properties": [ { "id": "1449069906033", "name": "MEDIA_HEIGHT", "value": "11" }, { "id": "1449069908929", "name": "MEDIA_WIDTH", "value": "8.5" }, { "id": "1571841122054", "name": "DISPLAY_HEIGHT", "value": "11" }, { "id": "1571841164815", "name": "DISPLAY_WIDTH", "value": "8.5" } ] } }, { "id": "1448981549581", "name": "Print Color", "choice": { "id": "1448988600611", "name": "Full Color", "properties": [ { "id": "1453242778807", "name": "PRINT_COLOR", "value": "COLOR" } ] } }, { "id": "1448981549269", "name": "Sides", "choice": { "id": "1448988124560", "name": "Single-Sided", "properties": [ { "id": "1470166759236", "name": "SIDE_NAME", "value": "Single Sided" }, { "id": "1461774376168", "name": "SIDE", "value": "SINGLE" } ] } }, { "id": "1448984679218", "name": "Orientation", "choice": { "id": "1449000016327", "name": "Horizontal", "properties": [ { "id": "1453260266287", "name": "PAGE_ORIENTATION", "value": "LANDSCAPE" } ] } }, { "id": "1534920174638", "name": "Envelope", "choice": { "id": "1634129308274", "name": "None", "properties": [] } }, { "id": "1448981549741", "name": "Paper Type", "choice": { "id": "1448988666879", "name": "Gloss Text", "properties": [ { "id": "1450324098012", "name": "MEDIA_TYPE", "value": "CT" }, { "id": "1453234015081", "name": "PAPER_COLOR", "value": "#FFFFFF" }, { "id": "1470166630346", "name": "MEDIA_NAME", "value": "Gloss Text" }, { "id": "1471275182312", "name": "MEDIA_CATEGORY", "value": "TEXT_GLOSS" } ] } } ], "pageExceptions": [], "contentAssociations": [ { "parentContentReference": "13169008873132051940009207686081156257085", "contentReference": "13169046574124984641609941565731181136468", "contentType": "IMAGE", "fileName": "aviso.jpg", "contentReqId": "1455709847200", "name": "Front_Side", "desc": null, "purpose": "SINGLE_SHEET_FRONT", "specialInstructions": "", "printReady": true, "pageGroups": [ { "start": 1, "end": 1, "width": 11, "height": 8.5, "orientation": "LANDSCAPE" } ] } ], "properties": [ { "id": "1453242488328", "name": "ZOOM_PERCENTAGE", "value": "50" }, { "id": "1453243262198", "name": "ENCODE_QUALITY", "value": "100" }, { "id": "1453894861756", "name": "LOCK_CONTENT_ORIENTATION", "value": false }, { "id": "1453895478444", "name": "MIN_DPI", "value": "150.0" }, { "id": "1454950109636", "name": "USER_SPECIAL_INSTRUCTIONS", "value": null }, { "id": "1455050109636", "name": "DEFAULT_IMAGE_WIDTH", "value": "8.5" }, { "id": "1455050109631", "name": "DEFAULT_IMAGE_HEIGHT", "value": "11" }, { "id": "1464709502522", "name": "PRODUCT_QTY_SET", "value": "50" }, { "id": "1459784717507", "name": "SKU", "value": "2821" }, { "id": "1470151626854", "name": "SYSTEM_SI", "value": "ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page." }, { "id": "1494365340946", "name": "PREVIEW_TYPE", "value": "DYNAMIC" }, { "id": "1470151737965", "name": "TEMPLATE_AVAILABLE", "value": "YES" }, { "id": "1459784776049", "name": "PRICE", "value": null }, { "id": "1490292304798", "name": "MIGRATED_PRODUCT", "value": "true" }, { "id": "1558382273340", "name": "PNI_TEMPLATE", "value": "NO" }, { "id": "1602530744589", "name": "CONTROL_ID", "value": "4" }, { "id": "1614715469176", "name": "IMPOSE_TEMPLATE_ID", "value": "0" } ] } ], "fxoMenuId": "1614105200640-4", "productConfig": { "productPresetId": "1602518818916", "fileCreated": "2022-08-23T02:43:21.013Z" } }';

        $serializedProductData = '{"serializedProductData":{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169046574124984641609941565731181136468","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}]},"productPresetId":"1602518818916"}';

        $externalProductData = json_decode($externalProductData, true);
        $serializedProductData = json_decode($serializedProductData, true);

        $this->assertEquals($serializedProductData, $this->orderHistoryReorderMock->serializeProductData($externalProductData));
    }

    /**
     * test serializeProductData with new json 
     *
     * @return void
     */
    public function testSerializeProductDataWithoutProductPresetId()
    {
        $externalProductData = '{"external_prod":[{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169046574124984641609941565731181136468","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}],"preview_url":"13169046574124984641609941565731181136468","fxo_product":""}]}';

        $serializedProductData = '{"serializedProductData":{"productionContentAssociations":[],"userProductName":"Flyers","id":"1463680545590","version":1,"name":"Flyer","qty":50,"priceable":true,"instanceId":1661222574939,"proofRequired":false,"isOutSourced":false,"features":[{"id":"1448981549109","name":"Paper Size","choice":{"id":"1448986650332","name":"8.5x11","properties":[{"id":"1449069906033","name":"MEDIA_HEIGHT","value":"11"},{"id":"1449069908929","name":"MEDIA_WIDTH","value":"8.5"},{"id":"1571841122054","name":"DISPLAY_HEIGHT","value":"11"},{"id":"1571841164815","name":"DISPLAY_WIDTH","value":"8.5"}]}},{"id":"1448981549581","name":"Print Color","choice":{"id":"1448988600611","name":"Full Color","properties":[{"id":"1453242778807","name":"PRINT_COLOR","value":"COLOR"}]}},{"id":"1448981549269","name":"Sides","choice":{"id":"1448988124560","name":"Single-Sided","properties":[{"id":"1470166759236","name":"SIDE_NAME","value":"Single Sided"},{"id":"1461774376168","name":"SIDE","value":"SINGLE"}]}},{"id":"1448984679218","name":"Orientation","choice":{"id":"1449000016327","name":"Horizontal","properties":[{"id":"1453260266287","name":"PAGE_ORIENTATION","value":"LANDSCAPE"}]}},{"id":"1534920174638","name":"Envelope","choice":{"id":"1634129308274","name":"None","properties":[]}},{"id":"1448981549741","name":"Paper Type","choice":{"id":"1448988666879","name":"Gloss Text","properties":[{"id":"1450324098012","name":"MEDIA_TYPE","value":"CT"},{"id":"1453234015081","name":"PAPER_COLOR","value":"#FFFFFF"},{"id":"1470166630346","name":"MEDIA_NAME","value":"Gloss Text"},{"id":"1471275182312","name":"MEDIA_CATEGORY","value":"TEXT_GLOSS"}]}}],"pageExceptions":[],"contentAssociations":[{"parentContentReference":"13169008873132051940009207686081156257085","contentReference":"13169046574124984641609941565731181136468","contentType":"IMAGE","fileName":"aviso.jpg","contentReqId":"1455709847200","name":"Front_Side","desc":null,"purpose":"SINGLE_SHEET_FRONT","specialInstructions":"","printReady":true,"pageGroups":[{"start":1,"end":1,"width":11,"height":8.5,"orientation":"LANDSCAPE"}]}],"properties":[{"id":"1453242488328","name":"ZOOM_PERCENTAGE","value":"50"},{"id":"1453243262198","name":"ENCODE_QUALITY","value":"100"},{"id":"1453894861756","name":"LOCK_CONTENT_ORIENTATION","value":false},{"id":"1453895478444","name":"MIN_DPI","value":"150.0"},{"id":"1454950109636","name":"USER_SPECIAL_INSTRUCTIONS","value":null},{"id":"1455050109636","name":"DEFAULT_IMAGE_WIDTH","value":"8.5"},{"id":"1455050109631","name":"DEFAULT_IMAGE_HEIGHT","value":"11"},{"id":"1464709502522","name":"PRODUCT_QTY_SET","value":"50"},{"id":"1459784717507","name":"SKU","value":"2821"},{"id":"1470151626854","name":"SYSTEM_SI","value":"ATTENTION TEAM MEMBER: Use the following instructions to produce this order.DO NOT use the Production Instructions listed above. Flyer Package specifications: Yield 50, Single Sided Color 8.5x11 Gloss Text (CT), Full Page."},{"id":"1494365340946","name":"PREVIEW_TYPE","value":"DYNAMIC"},{"id":"1470151737965","name":"TEMPLATE_AVAILABLE","value":"YES"},{"id":"1459784776049","name":"PRICE","value":null},{"id":"1490292304798","name":"MIGRATED_PRODUCT","value":"true"},{"id":"1558382273340","name":"PNI_TEMPLATE","value":"NO"},{"id":"1602530744589","name":"CONTROL_ID","value":"4"},{"id":"1614715469176","name":"IMPOSE_TEMPLATE_ID","value":"0"}]},"productPresetId":""}';

        $externalProductData = json_decode($externalProductData, true);
        $serializedProductData = json_decode($serializedProductData, true);

        $this->assertEquals($serializedProductData, $this->orderHistoryReorderMock->serializeProductData($externalProductData));
    }
}
