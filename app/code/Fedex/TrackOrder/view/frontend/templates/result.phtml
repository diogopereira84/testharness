<?php
/** @var \Fedex\TrackOrder\Block\Order\OrderDetails $block */
$orderIds = $block->getData('search');
$trackOrderViewModel = $block->getTrackOrderHomeViewModel();
$segregatedOrderIds = $trackOrderViewModel->getSegregatedOrderIds($orderIds);
$deleteRowButtonIconUrl = $block->getViewFileUrl('Fedex_TrackOrder::images/remove-button.png');

// XAPI and FUSE Orders
if ($segregatedOrderIds['apiOrders']) {
    foreach ($segregatedOrderIds['apiOrders'] as $apiOrderId) {
        $apiOrderData = $trackOrderViewModel->getOrderlistApi($apiOrderId);
        if ($apiOrderData) {
            if ($apiOrderData['isValid']) {
                // Assigning order status to a custom variable to reuse the value in the below helper function
                $orderStatus = $apiOrderData['order_details']['order_status'] = $apiOrderData['order_details']['status'];
                $orderStatusDetail = $block->getOrderStatusDetail($apiOrderData, 'order_details');
                $orderStatusImageUrl = $this->getViewFileUrl('Fedex_TrackOrder::images/' . $orderStatusDetail . '-icon.png');
                include($block->getTemplateFile('Fedex_TrackOrder::api_order_details_page.phtml'));
            }
        }
    }
}
// Magento Orders
if ($segregatedOrderIds['magOrders']) {
    $orderData = $block->getOrderlist($segregatedOrderIds['magOrders']);
    if (isset($orderData)) {
        foreach ($orderData as $key => $value) {
            if ($orderData[$key]['isValid']) { ?>
                <?php if($trackOrderViewModel->toggleCodeImprovementLogic()): ?>
                    <?= $block->getTrackorderDetailsPage($orderIds, $orderData, $key) ?>
                <?php else: ?>
                    <?php
                    $orderStatus = $block->getOrderStatusHeading($orderData, $key);
                    $orderStatusDetail = $block->getOrderStatusDetail($orderData, $key);
                    $orderMktStatusDetail = $trackOrderViewModel->getMktOrderStatusDetail($orderData, $key);
                    $isOrderDelayed = $block->isOrderDelayed($orderData, $key);
                    $isMktOrderDelayed = $block->isMktOrderDelayed($orderData, $key);
                    $orderStatusImageUrl = $this->getViewFileUrl('Fedex_TrackOrder::images/' . $orderStatusDetail . '-icon.png');
                    ?>
                    <?php include($block->getTemplateFile('Fedex_TrackOrder::order_details_page.phtml')) ?>
                <?php endif; ?>
            <?php }
        }
    }
}
?>
<script type="text/javascript">
    function closeDelayBanner(button) {
        var banner = button.parentNode;
        banner.style.display = 'none';
    }

    function ShowProducthide(productDetailsSectionId, itemSectionsId, imgid) {
        var productDetailsBlock = document.getElementById(productDetailsSectionId);
        var itemDetailsBlock = document.getElementById(itemSectionsId);

        if (productDetailsBlock.style.display == "none" || productDetailsBlock.style.display == '') {
            productDetailsBlock.style.display = "flex";
            itemDetailsBlock.style.display = "none";
        } else {
            productDetailsBlock.style.display = "none";
            itemDetailsBlock.style.display = "flex";
        }
    }
</script>
